import{r as a,Z as i,j as e,a as ee}from"./index-BJoL_Dl0.js";function se(){const[n,d]=a.useState({curr:30,volt:220,relay:!0}),[r,c]=a.useState({curr:28,volt:220,relay:!0}),[z,V]=a.useState([]),[p,D]=a.useState("auto"),[v,E]=a.useState(700),[m,_]=a.useState(i&&i[0]?i[0].id:null),[y,T]=a.useState(()=>i&&i[0]&&i[0].substations[0]?i[0].substations[0].id:null),[f,L]=a.useState(()=>{const t=i&&i[0];return t&&t.substations[1]?t.substations[1].id:t&&t.substations[0]?t.substations[0].id:null}),[j,P]=a.useState(0),[w,N]=a.useState(0),[S,I]=a.useState(0),[A,$]=a.useState(!1),[R,k]=a.useState({line1:0,line2:0}),g=a.useRef(null),l=t=>{const s=new Date().toLocaleTimeString();V(o=>[{time:s,text:t},...o].slice(0,500))},K=()=>{d(t=>{let s=t.curr+(Math.random()-.5)*2.5;s<0&&(s=.05);let o=t.volt+(Math.random()-.5)*1.5;return{...t,curr:s,volt:o}}),c(t=>{let s=t.curr+(Math.random()-.5)*2.5;s<0&&(s=.05);let o=t.volt+(Math.random()-.5)*1.5;return{...t,curr:s,volt:o}})},Z=()=>{B();const t=Number(v)||700;g.current=setInterval(()=>{K(),Math.random()<.02&&O()},t),l("Auto simulation started")},B=()=>{g.current&&(clearInterval(g.current),g.current=null,l("Auto stopped"))};a.useEffect(()=>(p==="auto"&&Z(),()=>B()),[p,v]);const O=()=>{d(t=>({...t,curr:120,volt:280})),l(`Injected spike on Line A (${y||"unknown"})`),C("line1")},h=async t=>{if(A)try{await ee.post("/logs",t)}catch(s){l("Failed to post to backend: "+(s&&s.message?s.message:s))}},q=()=>{d(t=>({...t,relay:!0})),c(t=>({...t,relay:!0})),l("Reset relays to ON")},C=t=>{P(s=>s+1),t==="line1"?(d(s=>({...s,relay:!1})),N(s=>s+1),l("Line 1 TRIPPED (relay opened)"),h({zone:"POC",substation:"Substation A",status:"fault",message:"Line 1 TRIPPED (relay opened)",time:new Date().toISOString()}),k(s=>({...s,line1:8})),M("line1")):(c(s=>({...s,relay:!1})),I(s=>s+1),l("Line 2 TRIPPED (relay opened)"),h({zone:"POC",substation:"Substation B",status:"fault",message:"Line 2 TRIPPED (relay opened)",time:new Date().toISOString()}),k(s=>({...s,line2:8})),M("line2")),setTimeout(()=>{t==="line1"?(d(s=>({...s,relay:!0})),l("Line 1 re-enabled after cooldown"),h({zone:"POC",substation:"Substation A",status:"ok",message:"Line 1 re-enabled",time:new Date().toISOString()})):(c(s=>({...s,relay:!0})),l("Line 2 re-enabled after cooldown"),h({zone:"POC",substation:"Substation B",status:"ok",message:"Line 2 re-enabled",time:new Date().toISOString()}))},8e3)},M=t=>{let s=t==="line1"?"line1":"line2";const o=setInterval(()=>{k(b=>{const F=Math.max(0,b[s]-1);return F===0&&clearInterval(o),{...b,[s]:F}})},1e3)},W=t=>{t===1?N(s=>s+1):I(s=>s+1)},H=()=>{l("Manual TRIP requested for Line 1"),C("line1")},U=()=>{const t=i.find(s=>s.id===m)?.substations.find(s=>s.id===f)?.name||f;l(`Manual TRIP requested for Substation B: ${t}`),C("line2")},x=t=>typeof t=="number"?t.toFixed(2):"--",u=t=>typeof t=="number"?t.toFixed(1):"--",X=`:root{--bg:#f6fafc; --card:#ffffff; --muted:#6b7280; --accent:#0ea5a4; --danger:#ef4444; --ok:#16a34a; --wire:#0f766e; --glass: rgba(2,6,23,0.04); --shadow: 0 6px 18px rgba(13, 20, 25, 0.08); --radius:12px; --mono:ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Helvetica Neue', monospace; }
.proof-root{background:var(--bg);padding:18px 12px 36px;box-sizing:border-box;color:#0f1720;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
.proof-root .wrap{max-width:1100px;margin:20px auto;padding:18px}
.proof-root header{display:flex;align-items:center;justify-content:space-between}
.proof-root h1{margin:0;font-size:18px}
.proof-root .grid{display:grid;grid-template-columns:minmax(280px,360px) 1fr;gap:16px;margin-top:16px;align-items:start}
.proof-root .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px}
.proof-root .controls .row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.proof-root label.small{font-size:12px;color:var(--muted);min-width:86px}
.proof-root input,.proof-root select,.proof-root button{font-size:13px}
.proof-root input,.proof-root select{padding:8px;border-radius:8px;border:1px solid #e6eef8;background:#fff}
.proof-root button{padding:8px 10px;border-radius:8px;border:none;background:var(--accent);color:white;cursor:pointer}
.proof-root button.ghost{background:transparent;border:1px solid #e6eef8;color:var(--muted)}
.proof-root .diagram{padding:18px;display:flex;gap:16px;align-items:center;justify-content:space-between}
.proof-root .pole{max-width:220px;width:100%;text-align:center}
.proof-root .pole .title{font-weight:600;margin-bottom:8px}
.proof-root .icon-box{display:inline-grid;place-items:center;width:120px;height:100px;border-radius:10px;background:var(--glass);box-shadow:inset 0 1px 0 rgba(255,255,255,0.6);}
.proof-root .meter{font-size:14px;color:var(--muted);margin-top:8px}
.proof-root svg.icon{width:56px;height:56px}
.proof-root .relay-btn{cursor:pointer;display:inline-flex;align-items:center;gap:8px}
.proof-root .wire{height:6px;background:var(--wire);border-radius:6px;flex:1;position:relative;overflow:hidden}
.proof-root .wire::after{content:'';position:absolute;left:0;top:0;bottom:0;width:100%;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));}
.proof-root .wire.flash{animation:wireFlash 0.9s ease-in-out 3}
@keyframes wireFlash{0%{background:var(--wire)}50%{background:var(--danger)}100%{background:var(--wire)}}
.proof-root .relay-ind{display:inline-block;transition:transform 300ms ease, background 300ms ease,border-color 300ms;box-shadow:0 0 0 rgba(0,0,0,0);border-radius:8px;padding:6px}
.proof-root .relay-ind.off{background:#fff0f0;color:var(--danger);transform:rotate(-6deg);box-shadow:0 6px 18px rgba(239,68,68,0.08)}
.proof-root .relay-ind.on{background:#f0fff6;color:var(--ok);transform:rotate(0);box-shadow:0 8px 28px rgba(6,95,84,0.08)}
.proof-root .relay-ind svg{width:36px;height:36px}
.proof-root .logs{height:200px;overflow:auto;background:#fafafa;border-radius:8px;padding:8px;border:1px solid #eef2f7;font-family:var(--mono);font-size:13px;color:#123}
.proof-root .log-line{padding:6px 0;border-bottom:1px dashed #f1f5f9}
@media (max-width:900px){ .proof-root .grid{grid-template-columns:1fr; } .proof-root .diagram{flex-direction:column;align-items:stretch} }
.proof-root .tt{position:relative;display:inline-block}
.proof-root .tt:hover::after{content:attr(data-tip);position:absolute;left:50%;transform:translateX(-50%);bottom:125%;background:#0f1720;color:#fff;padding:6px 8px;border-radius:6px;font-size:12px;white-space:nowrap}
.proof-root .muted{color:var(--muted);font-size:13px}
.proof-root .flex{display:flex;gap:8px;align-items:center}
.proof-root .pulse{transform:rotate(-8deg) scale(0.98);} /* pulse glow */
.proof-root .glow-on{animation:glow 1.6s infinite ease-in-out}
.proof-root .glow-off{animation:glowOff 1.4s infinite ease-in-out}
@keyframes glow{0%{box-shadow:0 4px 18px rgba(14,165,164,0.06)}50%{box-shadow:0 10px 32px rgba(14,165,164,0.12)}100%{box-shadow:0 4px 18px rgba(14,165,164,0.06)}}
@keyframes glowOff{0%{box-shadow:0 4px 18px rgba(239,68,68,0.04)}50%{box-shadow:0 12px 36px rgba(239,68,68,0.10)}100%{box-shadow:0 4px 18px rgba(239,68,68,0.04)}}
`,G=`relay-ind ${n.relay?"on":"off"}`,J=`relay-ind ${r.relay?"on":"off"}`,Q=w?"pulse":"",Y=S?"pulse":"";return a.useEffect(()=>{if(!w)return;const t=setTimeout(()=>N(0),420);return()=>clearTimeout(t)},[w]),a.useEffect(()=>{if(!S)return;const t=setTimeout(()=>I(0),420);return()=>clearTimeout(t)},[S]),a.useEffect(()=>{if(!j)return;const t=setTimeout(()=>P(0),1200);return()=>clearTimeout(t)},[j]),e.jsxs("div",{className:"proof-root",children:[e.jsx("style",{children:X}),e.jsxs("div",{className:"wrap",children:[e.jsxs("header",{children:[e.jsx("h1",{children:"LV Line Simulator — Light Theme"}),e.jsx("div",{className:"muted",children:"Embedded POC — values are simulated locally"})]}),e.jsxs("div",{className:"grid",children:[e.jsxs("div",{className:"card controls",children:[e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Simulator"}),e.jsxs("select",{id:"simMode",value:p,onChange:t=>D(t.target.value),children:[e.jsx("option",{value:"auto",children:"Auto"}),e.jsx("option",{value:"manual",children:"Manual"})]})]}),e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Zone"}),e.jsx("select",{value:m,onChange:t=>{const s=t.target.value;_(s);const o=i.find(b=>b.id===s);o&&o.substations&&o.substations.length&&(T(o.substations[0].id),L(o.substations[1]?o.substations[1].id:o.substations[0].id))},children:i.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Substation A"}),e.jsx("select",{value:y,onChange:t=>T(t.target.value),children:(i.find(t=>t.id===m)?.substations||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Substation B"}),e.jsx("select",{value:f,onChange:t=>L(t.target.value),children:(i.find(t=>t.id===m)?.substations||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Interval (ms)"}),e.jsx("input",{id:"simInterval",value:v,onChange:t=>E(Number(t.target.value||700))})]}),e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Manual Controls"}),p==="manual"?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{minWidth:64},className:"muted",children:"A I"}),e.jsx("input",{type:"range",min:"0",max:"200",value:n.curr,onChange:t=>d(s=>({...s,curr:Number(t.target.value)}))}),e.jsxs("div",{style:{minWidth:60,textAlign:"right"},children:[x(n.curr)," A"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{minWidth:64},className:"muted",children:"A V"}),e.jsx("input",{type:"range",min:"180",max:"300",value:n.volt,onChange:t=>d(s=>({...s,volt:Number(t.target.value)}))}),e.jsxs("div",{style:{minWidth:60,textAlign:"right"},children:[u(n.volt)," V"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{minWidth:64},className:"muted",children:"B I"}),e.jsx("input",{type:"range",min:"0",max:"200",value:r.curr,onChange:t=>c(s=>({...s,curr:Number(t.target.value)}))}),e.jsxs("div",{style:{minWidth:60,textAlign:"right"},children:[x(r.curr)," A"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{style:{minWidth:64},className:"muted",children:"B V"}),e.jsx("input",{type:"range",min:"180",max:"300",value:r.volt,onChange:t=>c(s=>({...s,volt:Number(t.target.value)}))}),e.jsxs("div",{style:{minWidth:60,textAlign:"right"},children:[u(r.volt)," V"]})]})]}):e.jsx("div",{className:"muted",children:"Switch to Manual mode to access per-substation controls"})]}),e.jsxs("div",{className:"row",children:[e.jsx("label",{className:"small",children:"Inject"}),e.jsx("button",{id:"injectSpike",onClick:O,children:"Inject Spike"}),e.jsx("button",{id:"resetLines",className:"ghost",onClick:q,children:"Reset"})]}),e.jsx("hr",{style:{border:"none",borderTop:"1px solid #eef2f7",margin:"12px 0"}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("label",{style:{fontSize:13,fontWeight:700},children:"Backend logs"}),e.jsxs("label",{style:{fontSize:13},className:"muted",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:t=>$(t.target.checked),style:{marginRight:8}}),"Send to /logs"]})]}),e.jsxs("div",{className:"muted",children:["Cooldown: L1 ",R.line1,"s • L2 ",R.line2,"s"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[e.jsx("div",{className:"muted",children:"Line controls"}),e.jsx("div",{className:"muted",children:"Status"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{className:"flex",children:[e.jsx("strong",{children:i.find(t=>t.id===m)?.substations.find(t=>t.id===y)?.name||"Substation A"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginLeft:6},children:"Pole A"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"trip1",className:"ghost",onClick:H,children:"TRIP"}),e.jsx("div",{id:"stat1",className:"muted",children:n.relay?"ON":"OFF"})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{className:"flex",children:[e.jsx("strong",{children:i.find(t=>t.id===m)?.substations.find(t=>t.id===f)?.name||"Substation B"}),e.jsx("div",{className:"muted",style:{fontSize:12,marginLeft:6},children:"Pole B"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{id:"trip2",className:"ghost",onClick:U,children:"TRIP"}),e.jsx("div",{id:"stat2",className:"muted",children:r.relay?"ON":"OFF"})]})]})]}),e.jsx("hr",{style:{border:"none",borderTop:"1px solid #eef2f7",margin:"12px 0"}}),e.jsx("div",{style:{fontWeight:600,marginBottom:8},children:"Logs"}),e.jsx("div",{id:"logs",className:"logs",children:z.map((t,s)=>e.jsxs("div",{className:"log-line",children:[t.time,"  —  ",t.text]},s))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"diagram",children:[e.jsxs("div",{className:"pole",children:[e.jsx("div",{className:"title",children:"Substation A"}),e.jsx("div",{className:"icon-box",children:e.jsx("img",{src:"/hvac_tower.svg",alt:"tower",style:{width:64,height:64,objectFit:"contain"}})}),e.jsxs("div",{className:"meter",id:"pole1_vals",children:["I: ",x(n.curr)," A | V: ",u(n.volt)," V"]}),e.jsx("div",{style:{marginTop:10},children:e.jsxs("button",{className:"relay-btn",id:"relayBtn1",onClick:()=>{d(t=>({...t,relay:!t.relay})),W(1)},children:[e.jsx("span",{className:`${G} ${Q} tt`,id:"relayInd1","data-tip":`Relay 1 — ${n.relay?"ON":"OFF"}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"7",width:"18",height:"10",rx:"3",fill:"#dffaf2",stroke:"#0b6b61"}),e.jsx("circle",{cx:"8.5",cy:"12",r:"3",fill:"#fff",stroke:"#0b6b61"})]})}),e.jsx("span",{className:"muted",children:"Relay"})]})})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:10,flex:1,minWidth:180},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",children:"LT Line"}),e.jsx("div",{className:j?"wire flash":"wire",id:"wireMid"})]})}),e.jsxs("div",{className:"pole",children:[e.jsx("div",{className:"title",children:"Substation B"}),e.jsx("div",{className:"icon-box",children:e.jsx("img",{src:"/hvac_tower.svg",alt:"tower",style:{width:64,height:64,objectFit:"contain"}})}),e.jsxs("div",{className:"meter",id:"pole2_vals",children:["I: ",x(r.curr)," A | V: ",u(r.volt)," V"]}),e.jsx("div",{style:{marginTop:10},children:e.jsxs("button",{className:"relay-btn",id:"relayBtn2",onClick:()=>{c(t=>({...t,relay:!t.relay})),W(2)},children:[e.jsx("span",{className:`${J} ${Y} tt`,id:"relayInd2","data-tip":`Relay 2 — ${r.relay?"ON":"OFF"}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"7",width:"18",height:"10",rx:"3",fill:"#dffaf2",stroke:"#0b6b61"}),e.jsx("circle",{cx:"8.5",cy:"12",r:"3",fill:"#fff",stroke:"#0b6b61"})]})}),e.jsx("span",{className:"muted",children:"Relay"})]})})]})]}),e.jsxs("div",{style:{marginTop:14,display:"flex",gap:14,alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{className:"card",style:{flex:1,padding:10,boxShadow:"none"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Line 1"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"Current"}),e.jsxs("div",{id:"l1_curr_val",style:{fontWeight:700},children:[x(n.curr)," A"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:6},children:[e.jsx("div",{className:"muted",children:"Voltage"}),e.jsxs("div",{id:"l1_volt_val",style:{fontWeight:700},children:[u(n.volt)," V"]})]})]}),e.jsxs("div",{className:"card",style:{flex:1,padding:10,boxShadow:"none"},children:[e.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Line 2"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("div",{className:"muted",children:"Current"}),e.jsxs("div",{id:"l2_curr_val",style:{fontWeight:700},children:[x(r.curr)," A"]})]}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:6},children:[e.jsx("div",{className:"muted",children:"Voltage"}),e.jsxs("div",{id:"l2_volt_val",style:{fontWeight:700},children:[u(r.volt)," V"]})]})]})]})]})]})]})]})}export{se as default};
